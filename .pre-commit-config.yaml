# Claude Kit - Pre-commit Configuration
# See https://pre-commit.com for more information
#
# Installation:
#   pip install pre-commit
#   pre-commit install
#
# Or use setup script:
#   ./scripts/setup-hooks.sh pre-commit

repos:
  - repo: local
    hooks:
      # Template validation
      - id: validate-templates
        name: Validate Claude Kit Templates
        entry: ./scripts/validate-templates.sh
        language: system
        pass_filenames: false
        files: ^template/
        stages: [commit]

      # Manifest integrity check
      - id: check-manifest-integrity
        name: Check Manifest Integrity
        entry: bash -c '
          CURRENT_HASH=$(jq -r ".manifest_hash // \"\"" template/.claude-kit-manifest.json);
          TEMP_MANIFEST=$(mktemp);
          trap "rm -f $TEMP_MANIFEST" EXIT;
          ./scripts/generate-manifest.sh > /dev/null 2>&1;
          cp template/.claude-kit-manifest.json "$TEMP_MANIFEST";
          git checkout -- template/.claude-kit-manifest.json 2>/dev/null || true;
          FRESH_HASH=$(jq -r ".manifest_hash // \"\"" "$TEMP_MANIFEST");
          if [ "$CURRENT_HASH" != "$FRESH_HASH" ]; then
            echo "";
            echo "‚ùå ERROR: Manifest out of sync";
            echo "";
            echo "Run: ./scripts/generate-manifest.sh";
            echo "";
            exit 1;
          fi
        '
        language: system
        pass_filenames: false
        files: ^template/
        stages: [commit]
